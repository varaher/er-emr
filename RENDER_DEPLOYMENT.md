# ðŸš€ Render Deployment Guide for ER-EMR Backend

## Prerequisites
- Render account (https://render.com)
- GitHub repository with your code
- MongoDB Atlas account (or any cloud MongoDB)

## ðŸ“‹ Step-by-Step Deployment

### 1. **Prepare MongoDB**
- Create a MongoDB Atlas cluster (free tier available)
- Get your connection string (looks like: `mongodb+srv://username:password@cluster.mongodb.net/`)
- Whitelist all IPs (0.0.0.0/0) in Network Access for Render

### 2. **Push Code to GitHub**
```bash
git add .
git commit -m "Render deployment configuration"
git push origin main
```

### 3. **Create New Web Service on Render**
1. Go to https://dashboard.render.com
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository
4. Configure the service:

   **Basic Settings:**
   - Name: `er-emr-backend`
   - Region: `Oregon (US West)` or closest to you
   - Branch: `main`
   - Root Directory: Leave empty (or specify if nested)
   - Runtime: `Python 3`

   **Build & Deploy:**
   - Build Command: `cd backend && chmod +x build.sh && ./build.sh`
   - Start Command: `cd backend && uvicorn server:app --host 0.0.0.0 --port $PORT`

### 4. **Set Environment Variables**
In Render dashboard, go to "Environment" tab and add:

| Key | Value | Notes |
|-----|-------|-------|
| `MONGO_URL` | `mongodb+srv://your-connection-string` | Your MongoDB Atlas URL |
| `DB_NAME` | `er_emr_database` | Database name |
| `CORS_ORIGINS` | `*` | Or specific frontend URL |
| `EMERGENT_LLM_KEY` | `sk-emergent-1489bD95832530eB39` | Your AI key |
| `JWT_SECRET` | Auto-generated by Render | Or use custom |
| `JWT_ALGORITHM` | `HS256` | JWT algorithm |
| `JWT_EXPIRATION_MINUTES` | `43200` | 30 days |
| `PYTHON_VERSION` | `3.11.0` | Python version |

### 5. **Deploy**
- Click "Create Web Service"
- Render will automatically build and deploy
- Wait for build to complete (5-10 minutes)
- Your backend will be live at: `https://your-app-name.onrender.com`

### 6. **Update Frontend Configuration**
Update `/app/frontend/.env`:
```env
REACT_APP_BACKEND_URL=https://your-app-name.onrender.com
```

### 7. **Deploy Frontend (Optional - using Render Static Site)**
1. Create new "Static Site" on Render
2. Connect same GitHub repo
3. Build Command: `cd frontend && yarn install && yarn build`
4. Publish Directory: `frontend/build`

## ðŸ”§ Troubleshooting

### Build Fails - "emergentintegrations not found"
- Check that `build.sh` has execute permissions
- Verify the extra-index-url is correct in `build.sh`

### Database Connection Error
- Verify MongoDB Atlas connection string
- Check that IP whitelist includes 0.0.0.0/0
- Test connection string locally first

### CORS Errors
- Update `CORS_ORIGINS` to include your frontend URL
- Example: `https://your-frontend.onrender.com,http://localhost:3000`

### App Crashes on Start
- Check Render logs: Dashboard â†’ Service â†’ Logs
- Verify all environment variables are set
- Ensure `server:app` path is correct

## ðŸ“Š Monitoring
- **Logs:** Available in Render dashboard
- **Metrics:** CPU, Memory usage visible in dashboard
- **Health Checks:** Render automatically monitors `/health` endpoint

## ðŸ’¡ Tips
- **Free Tier:** Render spins down after 15 min of inactivity (first request will be slow)
- **Paid Tier:** $7/month for always-on service
- **Custom Domain:** Available on paid plans
- **Auto-Deploy:** Enabled by default on git push

## ðŸ”— Useful Links
- Render Dashboard: https://dashboard.render.com
- Render Docs: https://render.com/docs
- MongoDB Atlas: https://www.mongodb.com/cloud/atlas

## âœ… Verification
After deployment, test these endpoints:
- `GET https://your-app.onrender.com/api/health` (if exists)
- `GET https://your-app.onrender.com/docs` (FastAPI auto docs)

## ðŸ†˜ Need Help?
- Render Community: https://community.render.com
- Render Status: https://status.render.com
